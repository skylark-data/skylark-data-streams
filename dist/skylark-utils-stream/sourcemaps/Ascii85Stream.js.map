{"version":3,"sources":["Ascii85Stream.js"],"names":["define","skylark","langx","streams","DecodeStream","Ascii85Stream","inherit","klassName","init","str","this","dict","input","Uint8Array","overrided","readBlock","tildaCode","charCodeAt","zCode","c","getByte","Lexer","isSpace","String","fromCharCode","eof","buffer","bufferLength","ensureBuffer","i","t"],"mappings":";;;;;;;AAAAA,QACI,wBACA,sBACA,YACA,kBACD,SAASC,EAASC,EAAOC,EAASC,GAEjC,GAAIC,GAAgBD,EAAaE,SAC7BC,UAAY,gBAEZC,KAAO,SAASC,GACZC,KAAKD,IAAMA,EACXC,KAAKC,KAAOF,EAAIE,KAChBD,KAAKE,MAAQ,GAAIC,YAAW,GAE5BH,KAAKI,aAGTC,UAAY,WAMR,IALA,GAAIC,GAAY,IAAIC,WAAW,GAC3BC,EAAQ,IAAID,WAAW,GACvBR,EAAMC,KAAKD,IAEXU,EAAIV,EAAIW,UACLC,MAAMC,QAAQC,OAAOC,aAAaL,KACrCA,EAAIV,EAAIW,SAEZ,KAAKD,GAAKA,IAAMH,EAEZ,YADAN,KAAKe,KAAM,EAIf,IACIC,GADAC,EAAejB,KAAKiB,YAIxB,IAAIR,GAAKD,EAAO,CACZQ,EAAShB,KAAKkB,aAAaD,EAAe,EAC1C,KAAK,GAAIE,GAAI,EAAGA,EAAI,IAAKA,EACrBH,EAAOC,EAAeE,GAAK,CAC/BnB,MAAKiB,cAAgB,MAClB,CACH,GAAIf,GAAQF,KAAKE,KACjBA,GAAM,GAAKO,CACX,KAAK,GAAIU,GAAI,EAAGA,EAAI,IAAKA,EAAG,CAExB,IADAV,EAAIV,EAAIW,UACDC,MAAMC,QAAQC,OAAOC,aAAaL,KACrCA,EAAIV,EAAIW,SAIZ,IAFAR,EAAMiB,GAAKV,GAENA,GAAKA,GAAKH,EACX,MAMR,GAJAU,EAAShB,KAAKkB,aAAaD,EAAeE,EAAI,GAC9CnB,KAAKiB,cAAgBE,EAAI,EAGrBA,EAAI,EAAG,CACP,KAAOA,EAAI,IAAKA,EACZjB,EAAMiB,GAAK,GACfnB,MAAKe,KAAM,EAGf,IAAK,GADDK,GAAI,EACCD,EAAI,EAAGA,EAAI,IAAKA,EACrBC,EAAQ,GAAJA,GAAUlB,EAAMiB,GAAK,GAE7B,KAAK,GAAIA,GAAI,EAAGA,GAAK,IAAKA,EACtBH,EAAOC,EAAeE,GAAS,IAAJC,EAC3BA,IAAM,KAQtB,OAAO3B,GAAQE,cAAgBA","file":"../Ascii85Stream.js","sourcesContent":["define([\r\n    \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"./streams\",\r\n    \"./DecodeStream\"\r\n], function(skylark, langx, streams, DecodeStream) {\r\n\r\n    var Ascii85Stream = DecodeStream.inherit({\r\n        klassName : \"Ascii85Stream\",\r\n\r\n        init : function(str) {\r\n            this.str = str;\r\n            this.dict = str.dict;\r\n            this.input = new Uint8Array(5);\r\n\r\n            this.overrided();          \r\n        },\r\n\r\n        readBlock : function() {\r\n            var tildaCode = '~'.charCodeAt(0);\r\n            var zCode = 'z'.charCodeAt(0);\r\n            var str = this.str;\r\n\r\n            var c = str.getByte();\r\n            while (Lexer.isSpace(String.fromCharCode(c)))\r\n                c = str.getByte();\r\n\r\n            if (!c || c === tildaCode) {\r\n                this.eof = true;\r\n                return;\r\n            }\r\n\r\n            var bufferLength = this.bufferLength,\r\n                buffer;\r\n\r\n            // special code for z\r\n            if (c == zCode) {\r\n                buffer = this.ensureBuffer(bufferLength + 4);\r\n                for (var i = 0; i < 4; ++i)\r\n                    buffer[bufferLength + i] = 0;\r\n                this.bufferLength += 4;\r\n            } else {\r\n                var input = this.input;\r\n                input[0] = c;\r\n                for (var i = 1; i < 5; ++i) {\r\n                    c = str.getByte();\r\n                    while (Lexer.isSpace(String.fromCharCode(c)))\r\n                        c = str.getByte();\r\n\r\n                    input[i] = c;\r\n\r\n                    if (!c || c == tildaCode)\r\n                        break;\r\n                }\r\n                buffer = this.ensureBuffer(bufferLength + i - 1);\r\n                this.bufferLength += i - 1;\r\n\r\n                // partial ending;\r\n                if (i < 5) {\r\n                    for (; i < 5; ++i)\r\n                        input[i] = 0x21 + 84;\r\n                    this.eof = true;\r\n                }\r\n                var t = 0;\r\n                for (var i = 0; i < 5; ++i)\r\n                    t = t * 85 + (input[i] - 0x21);\r\n\r\n                for (var i = 3; i >= 0; --i) {\r\n                    buffer[bufferLength + i] = t & 0xFF;\r\n                    t >>= 8;\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n    });\r\n\r\n    return streams.Ascii85Stream = Ascii85Stream;\r\n\r\n});\r\n"]}