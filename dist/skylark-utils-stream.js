/**
 * skylark-utils-stream - The stream features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){function r(t,e){if("."!==t[0])return t;var r=e.split("/"),s=t.split("/");r.pop();for(var i=0;i<s.length;i++)"."!=s[i]&&(".."==s[i]?r.pop():r.push(s[i]));return r.join("/")}var s=e.define,i=e.require,n="function"==typeof s&&s.amd,a=!n&&"undefined"!=typeof exports;if(!n&&!s){var h={};s=e.define=function(t,e,s){"function"==typeof s?(h[t]={factory:s,deps:e.map(function(e){return r(e,t)}),exports:null},i(t)):h[t]=s},i=e.require=function(t){if(!h.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var e=h[t];if(!e.exports){var r=[];e.deps.forEach(function(t){r.push(i(t))}),e.exports=e.factory.apply(window,r)}return e.exports}}if(!s)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(s,i),!n){var o=i("skylark-langx/skylark");a?exports=o:e.skylarkjs=o}}(function(t,e){t("skylark-utils-stream/streams",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){var r=function(){return r};return e.mixin(r,{Stream:Stream,DecodeStream:DecodeStream}),t.streams=r}),t("skylark-utils-stream/Stream",["skylark-langx/skylark","skylark-langx/langx","./streams"],function(t,e,r){var s=e.Evented.inherit({klassName:"Stream",init:function(t,e,r,s){this.bytes=new Uint8Array(t),this.start=e||0,this.pos=this.start,this.end=e+r||this.bytes.length,this.dict=s},length:{get:function(){return this.end-this.start}},getByte:function(){return this.pos>=this.end?null:this.bytes[this.pos++]},getBytes:function(t){var e=this.bytes,r=this.pos,s=this.end;if(!t)return e.subarray(r,s);var i=r+t;return i>s&&(i=s),this.pos=i,e.subarray(r,i)},lookChar:function(){return this.pos>=this.end?null:String.fromCharCode(this.bytes[this.pos])},getChar:function(){return this.pos>=this.end?null:String.fromCharCode(this.bytes[this.pos++])},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=this.start},moveStart:function(){this.start=this.pos},makeSubStream:function(t,e,r){return new s(this.bytes.buffer,t,e,r)},isStream:!0});return r.Stream=s}),t("skylark-utils-stream/DecodeStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./Stream"],function(t,e,r,s){var i=s.inherit({klassName:"DecodeStream",init:function(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null},ensureBuffer:function(t){var e=this.buffer,r=e?e.byteLength:0;if(t<r)return e;for(var s=512;s<t;)s<<=1;for(var i=new Uint8Array(s),n=0;n<r;++n)i[n]=e[n];return this.buffer=i},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var e,r=this.pos;if(t){for(this.ensureBuffer(r+t),e=r+t;!this.eof&&this.bufferLength<e;)this.readBlock();var s=this.bufferLength;e>s&&(e=s)}else{for(;!this.eof;)this.readBlock();e=this.bufferLength,e||(this.buffer=new Uint8Array(0))}return this.pos=e,this.buffer.subarray(r,e)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,e,r){for(var i=t+e;this.bufferLength<=i&&!this.eof;)this.readBlock();return new s(this.buffer,t,e,r)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}});return stream.DecodeStream=i}),t("skylark-utils-stream/Ascii85Stream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i=s.inherit({klassName:"Ascii85Stream",init:function(t){this.str=t,this.dict=t.dict,this.input=new Uint8Array(5),this.overrided()},readBlock:function(){for(var t="~".charCodeAt(0),e="z".charCodeAt(0),r=this.str,s=r.getByte();Lexer.isSpace(String.fromCharCode(s));)s=r.getByte();if(!s||s===t)return void(this.eof=!0);var i,n=this.bufferLength;if(s==e){i=this.ensureBuffer(n+4);for(var a=0;a<4;++a)i[n+a]=0;this.bufferLength+=4}else{var h=this.input;h[0]=s;for(var a=1;a<5;++a){for(s=r.getByte();Lexer.isSpace(String.fromCharCode(s));)s=r.getByte();if(h[a]=s,!s||s==t)break}if(i=this.ensureBuffer(n+a-1),this.bufferLength+=a-1,a<5){for(;a<5;++a)h[a]=117;this.eof=!0}for(var o=0,a=0;a<5;++a)o=85*o+(h[a]-33);for(var a=3;a>=0;--a)i[n+a]=255&o,o>>=8}}});return r.Ascii85Stream=i}),t("skylark-utils-stream/AsciiHexStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i={9:-1,32:-1,48:0,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,65:10,66:11,67:12,68:13,69:14,70:15,97:10,98:11,99:12,100:13,101:14,102:15},n=s.inherit({klassName:"AsciiHexStream",init:function(t){this.str=t,this.dict=t.dict,this.overrided()},readBlock:function(){var t,e,r,s,n,a,h,o=">".charCodeAt(0),f=this.str.getBytes();for(r=f.length+1>>1,s=this.ensureBuffer(this.bufferLength+r),n=this.bufferLength,a=0,h=f.length;a<h;a++){for(t=i[f[a]];t==-1&&a+1<h;)t=i[f[++a]];a+1<h&&f[a+1]!==o?(e=i[f[++a]],s[n++]=16*t+e):f[a]!==o&&(s[n++]=16*t)}this.bufferLength=n,this.eof=!0}});return r.AsciiHexStream=n}),t("skylark-utils-stream/ChunkedStream",["skylark-langx/skylark","skylark-langx/langx","./DecodeStream"],function(t,e,r){var s=Class.declare({"-parent-":Stream,"-interfaces-":[],"-protected-":{"-fields-":{numChunks:0,numChunksLoaded:0},"-methods-":{}},"-public-":{"-attributes-":{},"-methods-":{numChunks:function(){},getMissingChunks:function(){for(var t=[],e=0,r=this.numChunks;e<r;++e)e in this.loadedChunks||t.push(e);return t},getBaseStreams:function(){return[this]},allChunksLoaded:function(){var t=this._;return t.numChunksLoaded===t.numChunks},onReceiveData:function(t,e){var r=t+e.byteLength;assert(t%this.chunkSize===0,"Bad begin offset: "+t);var s=this.bytes.length;assert(r%this.chunkSize===0||r===s,"Bad end offset: "+r),this.bytes.set(new Uint8Array(e),t);for(var i=this.chunkSize,n=Math.floor(t/i),a=Math.floor((r-1)/i)+1,e=n;e<a;++e)e in this.loadedChunks||(this.loadedChunks[e]=!0,++this.numChunksLoaded)},onReceiveInitialData:function(t){this.bytes.set(t),this.initialDataLength=t.length;for(var e=this.end===t.length?this.numChunks:Math.floor(t.length/this.chunkSize),r=0;r<e;r++)this.loadedChunks[r]=!0,++this.numChunksLoaded},ensureRange:function(t,e){if(!(t>=e||e<=this.initialDataLength))for(var r=this.chunkSize,s=Math.floor(t/r),i=Math.floor((e-1)/r)+1,n=s;n<i;++n)if(!(n in this.loadedChunks))throw new MissingDataException(t,e)},nextEmptyChunk:function(t){for(var e=t,r=this.numChunks;e<r;++e)if(!(e in this.loadedChunks))return e;for(var e=0;e<t;++e)if(!(e in this.loadedChunks))return e;return null},hasChunk:function(t){return t in this._.loadedChunks},getByte:function(){var t=this.pos;return t>=this.end?-1:(this.ensureRange(t,t+1),this.bytes[this.pos++])},getBytes:function(t){var e=this.bytes,r=this.pos,s=this.end;if(!t)return this.ensureRange(r,s),e.subarray(r,s);var i=r+t;return i>s&&(i=s),this.ensureRange(r,i),this.pos=i,e.subarray(r,i)},peekBytes:function(t){var e=this.getBytes(t);return this.pos-=e.length,e},getByteRange:function(t,e){return this.ensureRange(t,e),this.bytes.subarray(t,e)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=this.start},moveStart:function(){this.start=this.pos},makeSubStream:function(t,e,r){function s(){}s.prototype=Object.create(this),s.prototype.getMissingChunks=function(){for(var t=this.chunkSize,e=Math.floor(this.start/t),r=Math.floor((this.end-1)/t)+1,s=[],i=e;i<r;++i)i in this.loadedChunks||s.push(i);return s};var i=new s;return i.pos=i.start=t,i.end=t+e||this.end,i.dict=r,i}}},"-constructor-":{initialize:[function(){this.overload("")},function(t){for(var e=t.length,r=new Uint8Array(e),s=0;s<e;++s)r[s]=t.charCodeAt(s);this.overrided(r)}]}});return s}),t("skylark-utils-stream/DecryptStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i=512,n=s.inherit({klassName:"DecryptStream",init:function(t,e){this.str=t,this.dict=t.dict,this.decrypt=e,this.overrided()},readBlock:function(){var t=this.str.getBytes(i);if(!t||0==t.length)return void(this.eof=!0);var e=this.decrypt;t=e(t);var r,s=this.bufferLength,n=t.length,a=this.ensureBuffer(s+n);for(r=0;r<n;r++)a[s++]=t[r];this.bufferLength=s}});return r.DecryptStream=n}),t("skylark-utils-stream/FakeStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i=s.inherit({klassName:"FakeStream",init:function(t){this.dict=t.dict,this.overrided()},readBlock:function(){var t=this.bufferLength;t+=1024;this.ensureBuffer(t);this.bufferLength=t},getBytes:function(t){var e,r=this.pos;if(t){for(this.ensureBuffer(r+t),e=r+t;!this.eof&&this.bufferLength<e;)this.readBlock();var s=this.bufferLength;e>s&&(e=s)}else this.eof=!0,e=this.bufferLength;return this.pos=e,this.buffer.subarray(r,e)}});return r.FakeStream=i}),t("skylark-utils-stream/FlateStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),a=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),h=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],o=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5],f=s.inherit({klassName:"FlateStream",init:function(t){var e=t.getBytes(),r=0;this.dict=t.dict;var s=e[r++],i=e[r++];s!=-1&&i!=-1||error("Invalid header in flate stream: "+s+", "+i),8!=(15&s)&&error("Unknown compression method in flate stream: "+s+", "+i),((s<<8)+i)%31!=0&&error("Bad FCHECK in flate stream: "+s+", "+i),32&i&&error("FDICT bit set in flate stream: "+s+", "+i),this.bytes=e,this.bytesPos=r,this.codeSize=0,this.codeBuf=0,this.overrided()},getBits:function(t){for(var e,r=this.codeSize,s=this.codeBuf,i=this.bytes,n=this.bytesPos;r<t;)"undefined"==typeof(e=i[n++])&&error("Bad encoding in flate stream"),s|=e<<r,r+=8;return e=s&(1<<t)-1,this.codeBuf=s>>t,this.codeSize=r-=t,this.bytesPos=n,e},getCode:function(t){for(var e=t[0],r=t[1],s=this.codeSize,i=this.codeBuf,n=this.bytes,a=this.bytesPos;s<r;){var h;"undefined"==typeof(h=n[a++])&&error("Bad encoding in flate stream"),i|=h<<s,s+=8}var o=e[i&(1<<r)-1],f=o>>16,u=65535&o;return(0==s||s<f||0==f)&&error("Bad encoding in flate stream"),this.codeBuf=i>>f,this.codeSize=s-f,this.bytesPos=a,u},generateHuffmanTable:function(t){for(var e=t.length,r=0,s=0;s<e;++s)t[s]>r&&(r=t[s]);for(var i=1<<r,n=new Uint32Array(i),a=1,h=0,o=2;a<=r;++a,h<<=1,o<<=1)for(var f=0;f<e;++f)if(t[f]==a){for(var u=0,l=h,s=0;s<a;++s)u=u<<1|1&l,l>>=1;for(var s=u;s<i;s+=o)n[s]=a<<16|f;++h}return[n,r]},readBlock:function(){var t=this.getBits(3);if(1&t&&(this.eof=!0),t>>=1,0==t){var e,r=this.bytes,s=this.bytesPos;"undefined"==typeof(e=r[s++])&&error("Bad block header in flate stream");var f=e;"undefined"==typeof(e=r[s++])&&error("Bad block header in flate stream"),f|=e<<8,"undefined"==typeof(e=r[s++])&&error("Bad block header in flate stream");var u=e;"undefined"==typeof(e=r[s++])&&error("Bad block header in flate stream"),u|=e<<8,u!=(65535&~f)&&error("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var l=this.bufferLength,c=this.ensureBuffer(l+f),d=l+f;this.bufferLength=d;for(var k=l;k<d;++k){if("undefined"==typeof(e=r[s++])){this.eof=!0;break}c[k]=e}return void(this.bytesPos=s)}var g,y;if(1==t)g=h,y=o;else if(2==t){for(var m=this.getBits(5)+257,v=this.getBits(5)+1,b=this.getBits(4)+4,S=new Uint8Array(i.length),p=0;p<b;++p)S[i[p]]=this.getBits(3);for(var B=this.generateHuffmanTable(S),C=0,p=0,x=m+v,L=new Uint8Array(x);p<x;){var w=this.getCode(B);if(16==w)var A=2,D=3,U=C;else if(17==w)var A=3,D=3,U=C=0;else{if(18!=w){L[p++]=C=w;continue}var A=7,D=11,U=C=0}for(var P=this.getBits(A)+D;P-- >0;)L[p++]=U}g=this.generateHuffmanTable(L.subarray(0,m)),y=this.generateHuffmanTable(L.subarray(m,x))}else error("Unknown block type in flate stream");for(var c=this.buffer,z=c?c.length:0,M=this.bufferLength;;){var q=this.getCode(g);if(q<256)M+1>=z&&(c=this.ensureBuffer(M+1),z=c.length),c[M++]=q;else{if(256==q)return void(this.bufferLength=M);q-=257,q=n[q];var N=q>>16;N>0&&(N=this.getBits(N));var C=(65535&q)+N;q=this.getCode(y),q=a[q],N=q>>16,N>0&&(N=this.getBits(N));var F=(65535&q)+N;M+C>=z&&(c=this.ensureBuffer(M+C),z=c.length);for(var H=0;H<C;++H,++M)c[M]=c[M-F]}}}});return r.FlateStream=f}),t("skylark-utils-stream/LZWStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i=s.inherit({klassName:"LZWStream",init:function(t,e){this.str=t,this.dict=t.dict,this.cachedData=0,this.bitsCached=0;for(var r=4096,s={earlyChange:e,codeLength:9,nextCode:258,dictionaryValues:new Uint8Array(r),dictionaryLengths:new Uint16Array(r),dictionaryPrevCodes:new Uint16Array(r),currentSequence:new Uint8Array(r),currentSequenceLength:0},i=0;i<256;++i)s.dictionaryValues[i]=i,s.dictionaryLengths[i]=1;this.lzwState=s,this.overrided()},readBits:function(t){for(var e=this.bitsCached,r=this.cachedData;e<t;){var s=this.str.getByte();if(null==s)return this.eof=!0,null;r=r<<8|s,e+=8}return this.bitsCached=e-=t,this.cachedData=r,this.lastCode=null,r>>>e&(1<<t)-1},readBlock:function(){var t,e,r,s=512,i=2*s,n=s,a=this.lzwState;if(a){var h=a.earlyChange,o=a.nextCode,f=a.dictionaryValues,u=a.dictionaryLengths,l=a.dictionaryPrevCodes,c=a.codeLength,d=a.prevCode,k=a.currentSequence,g=a.currentSequenceLength,y=0,m=this.bufferLength,v=this.ensureBuffer(this.bufferLength+i);for(t=0;t<s;t++){var b=this.readBits(c),S=g>0;if(b<256)k[0]=b,g=1;else{if(!(b>=258)){if(256==b){c=9,o=258,g=0;continue}this.eof=!0,delete this.lzwState;break}if(b<o)for(g=u[b],e=g-1,r=b;e>=0;e--)k[e]=f[r],r=l[r];else k[g++]=k[0]}if(S&&(l[o]=d,u[o]=u[d]+1,f[o]=k[0],o++,c=o+h&o+h-1?c:0|Math.min(Math.log(o+h)/.6931471805599453+1,12)),d=b,y+=g,i<y){do i+=n;while(i<y);v=this.ensureBuffer(this.bufferLength+i)}for(e=0;e<g;e++)v[m++]=k[e]}a.nextCode=o,a.codeLength=c,a.prevCode=d,a.currentSequenceLength=g,this.bufferLength=m}}});return r.LZWStream=i}),t("skylark-utils-stream/PredictorStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i=s.inherit({klassName:"PredictorStream",init:function(t,e){var r=this.predictor=e.get("Predictor")||1;if(r<=1)return t;2!==r&&(r<10||r>15)&&error("Unsupported predictor: "+r),2===r?this.readBlock=this.readBlockTiff:this.readBlock=this.readBlockPng,this.stream=t,this.dict=t.dict;var s=this.colors=e.get("Colors")||1,i=this.bits=e.get("BitsPerComponent")||8,n=this.columns=e.get("Columns")||1;this.pixBytes=s*i+7>>3,this.rowBytes=n*s*i+7>>3,this.overrided()},readBlockTiff:function(){var t=this.rowBytes,e=this.bufferLength,r=this.ensureBuffer(e+t),s=this.bits,i=this.colors,n=this.stream.getBytes(t),a=0,h=0,o=0,f=0,u=e;if(1===s)for(var l=0;l<t;++l){var c=n[l];a=a<<8|c,r[u++]=255&(c^a>>i),a&=65535}else if(8===s){for(var l=0;l<i;++l)r[u++]=n[l];for(;l<t;++l)r[u]=r[u-i]+n[l],u++}else{for(var d=new Uint8Array(i+1),k=(1<<s)-1,g=0,y=e,m=this.columns,l=0;l<m;++l)for(var v=0;v<i;++v)o<s&&(a=a<<8|255&n[g++],o+=8),d[v]=d[v]+(a>>o-s)&k,o-=s,h=h<<s|d[v],f+=s,f>=8&&(r[y++]=h>>f-8&255,f-=8);f>0&&(r[y++]=(h<<8-f)+(a&(1<<8-f)-1))}this.bufferLength+=t},readBlockPng:function(){var t=this.rowBytes,e=this.pixBytes,r=this.stream.getByte(),s=this.stream.getBytes(t),i=this.bufferLength,n=this.ensureBuffer(i+t),a=n.subarray(i-t,i);0==a.length&&(a=new Uint8Array(t));var h=i;switch(r){case 0:for(var o=0;o<t;++o)n[h++]=s[o];break;case 1:for(var o=0;o<e;++o)n[h++]=s[o];for(;o<t;++o)n[h]=n[h-e]+s[o]&255,h++;break;case 2:for(var o=0;o<t;++o)n[h++]=a[o]+s[o]&255;break;case 3:for(var o=0;o<e;++o)n[h++]=(a[o]>>1)+s[o];for(;o<t;++o)n[h]=(a[o]+n[h-e]>>1)+s[o]&255,h++;break;case 4:for(var o=0;o<e;++o){var f=a[o],u=s[o];n[h++]=f+u}for(;o<t;++o){var f=a[o],l=a[o-e],c=n[h-e],d=c+f-l,k=d-c;k<0&&(k=-k);var g=d-f;g<0&&(g=-g);var y=d-l;y<0&&(y=-y);var u=s[o];k<=g&&k<=y?n[h++]=c+u:g<=y?n[h++]=f+u:n[h++]=l+u}break;default:error("Unsupported predictor: "+r)}this.bufferLength+=t}});return r.PredictorStream=i}),t("skylark-utils-stream/StreamsSequenceStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(t,e,r,s){var i=s.inherit({klassName:"StreamsSequenceStream",init:function(t){this.dict=stream.dict,this.overrided()},readBlock:function(){var t=this.streams;if(0==t.length)return void(this.eof=!0);var e=t.shift(),r=e.getBytes(),s=this.bufferLength,i=s+r.length,n=this.ensureBuffer(i);n.set(r,s),this.bufferLength=i}});return r.StreamsSequenceStream=i}),t("skylark-utils-stream/StringStream",["skylark-langx/skylark","skylark-langx/langx","./streams","./Stream"],function(t,e,r,s){var i=s.inherit({klassName:"StringStream",init:function(t){for(var e=t.length,r=new Uint8Array(e),s=0;s<e;++s)r[s]=t.charCodeAt(s);this.overrided(r)}});return stream.StringStream=i}),t("skylark-utils-stream/main",["./streams","./Ascii85Stream","./AsciiHexStream","./ChunkedStream","./DecodeStream","./DecryptStream","./FakeStream","./FlateStream","./LZWStream","./PredictorStream","./Stream","./StreamsSequenceStream","./StringStream"],function(t){return t}),t("skylark-utils-stream",["skylark-utils-stream/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-utils-stream.js.map
